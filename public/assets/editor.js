function setup_wmd(e){return new WMDEditor(e)}(function(){function l(){var e={};return e.isIE=/msie/.test(f.userAgent.toLowerCase()),e.isIE_5or6=/msie 6/.test(f.userAgent.toLowerCase())||/msie 5/.test(f.userAgent.toLowerCase()),e.isIE_7plus=e.isIE&&!e.isIE_5or6,e.isOpera=/opera/.test(f.userAgent.toLowerCase()),e.isKonqueror=/konqueror/.test(f.userAgent.toLowerCase()),e}WMDEditor=function(e){this.options=WMDEditor.util.extend({},WMDEditor.defaults,e||{}),h(this,this.options),this.startEditor()},window.WMDEditor=WMDEditor,WMDEditor.defaults={version:2.1,output_format:"markdown",lineLength:40,button_bar:"wmd-button-bar",preview:"wmd-preview",output:"wmd-output",input:"wmd-input",imageDialogText:"<p style='margin-top: 0px'><b>Enter the image URL.</b></p><p>You can also add a title, which will be displayed as a tool tip.</p><p>Example:<br />http://i.imgur.com/1cZl4.jpg</p>",linkDialogText:"<p style='margin-top: 0px'><b>Enter the web address.</b></p><p>You can also add a title, which will be displayed as a tool tip.</p><p>Example:<br />http://www.google.com/</p>",imageDefaultText:"http://",linkDefaultText:"http://",imageDirectory:"images/",helpLink:"/wmd/markdownhelp.html",helpHoverTitle:"Markdown Syntax",helpTarget:"_blank",previewPollInterval:500,pastePollInterval:100,buttons:"bold italic  link blockquote code image  ol ul heading hr  undo redo help",autoFormatting:{list:!0,quote:!0,code:!0},modifierKeys:{bold:"b",italic:"i",link:"l",quote:"q",code:"k",image:"g",orderedList:"o",unorderedList:"u",heading:"h",horizontalRule:"r",redo:"y",undo:"z"},tagFilter:{enabled:!1,allowedTags:/^(<\/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol|p|pre|s|sup|sub|strong|strike|ul)>|<(br|hr)\s?\/?>)$/i,patternLink:/^(<a\shref=("|')(\#\d+|(https?:\/\/|ftp:\/\/|mailto:)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+)\2(\stitle="[^"<>]+")?\s?>|<\/a>)$/i,patternImage:/^(<img\ssrc="https?:(\/\/[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+)"(\swidth="\d{1,3}")?(\sheight="\d{1,3}")?(\salt="[^"<>]*")?(\stitle="[^"<>]*")?\s?\/?>)$/i}},WMDEditor.prototype={getPanels:function(){return{buttonBar:typeof this.options.button_bar=="string"?document.getElementById(this.options.button_bar):this.options.button_bar,preview:typeof this.options.preview=="string"?document.getElementById(this.options.preview):this.options.preview,output:typeof this.options.output=="string"?document.getElementById(this.options.output):this.options.output,input:typeof this.options.input=="string"?document.getElementById(this.options.input):this.options.input}},startEditor:function(){this.panels=this.getPanels(),this.previewMgr=new s(this),edit=new this.editor(this.previewMgr.refresh),this.previewMgr.refresh(!0)}};var e={isVisible:function(e){return e.offsetWidth>0||e.offsetHeight>0},addEvent:function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},removeEvent:function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},fixEolChars:function(e){return e=e.replace(/\r\n/g,"\n"),e=e.replace(/\r/g,"\n"),e},extendRegExp:function(e,t,n){if(t===null||t===undefined)t="";if(n===null||n===undefined)n="";var r=e.toString(),i="",s=r.match(/\/([gim]*)$/);return s===null?i=s[0]:i="",r=r.replace(/(^\/|\/[gim]*$)/g,""),r=t+r+n,new RegExp(r,i)},createImage:function(e){var t=imageDirectory+e,n=document.createElement("img");return n.className="wmd-button",n.src=t,n},prompt:function(n,r,i,s){var o,u,a,l,h;r===undefined&&(r="");var p=function(e){var t=e.charCode||e.keyCode;t===27&&d(!0)},d=function(t){e.removeEvent(document.body,"keydown",p);var n=a.value+(l.value?' "'+l.value+'"':"");return t?n=null:(n=n.replace("http://http://","http://"),n=n.replace("http://https://","https://"),n=n.replace("http://ftp://","ftp://"),s=="link"&&h.checked&&(n="!"+n)),o.parentNode.removeChild(o),u.parentNode.removeChild(u),i(n),!1},v=function(){u=document.createElement("div"),u.className="wmd-prompt-background",style=u.style,style.position="absolute",style.top="0",style.zIndex="10000",c.isKonqueror?style.backgroundColor="transparent":c.isIE?style.filter="alpha(opacity=50)":style.opacity="0.5";var e=t.getPageSize();style.height=e[1]+"px",c.isIE?(style.left=document.documentElement.scrollLeft,style.width=document.documentElement.clientWidth):(style.left="0",style.width="100%"),document.body.appendChild(u)},m=function(){o=document.createElement("div"),o.className="wmd-prompt-dialog",o.style.padding="10px;",o.style.position="fixed",o.style.width="400px",o.style.zIndex="10001";var i=document.createElement("div");i.innerHTML=n,i.style.padding="5px",o.appendChild(i);var u=document.createElement("form");u.onsubmit=function(){return d(!1)};var v=u.style;v.padding="0",v.margin="0",v.cssFloat="left",v.width="100%",v.textAlign="center",v.position="relative",o.appendChild(u);var m=document.createElement("label");v=m.style,v.display="block",v.width="80%",v.marginLeft=v.marginRight="auto",v.textAlign="left",u.appendChild(m),m.appendChild(document.createTextNode(s+" URL:")),a=document.createElement("input"),a.type="text",a.value=r,v=a.style,v.display="block",v.width="100%",v.marginLeft=v.marginRight="auto",m.appendChild(a),m=document.createElement("label"),v=m.style,v.display="block",v.width="80%",v.marginLeft=v.marginRight="auto",v.textAlign="left",u.appendChild(m),m.appendChild(document.createTextNode(s+" Title (Hover Text):")),l=document.createElement("input"),l.type="text",v=l.style,v.display="block",v.width="100%",v.marginLeft=v.marginRight="auto",m.appendChild(l),s=="link"&&(m=document.createElement("label"),v=m.style,v.display="block",v.textAlign="center",u.appendChild(m),h=document.createElement("input"),h.type="checkbox",h.value="!",m.appendChild(h),m.appendChild(document.createTextNode(" Have this link open in a new window")));var g=document.createElement("input");g.type="button",g.onclick=function(){return d(!1)},g.value="OK",v=g.style,v.margin="10px",v.display="inline",v.width="7em";var y=document.createElement("input");y.type="button",y.onclick=function(){return d(!0)},y.value="Cancel",v=y.style,v.margin="10px",v.display="inline",v.width="7em",/mac/.test(f.platform.toLowerCase())?(u.appendChild(y),u.appendChild(g)):(u.appendChild(g),u.appendChild(y)),e.addEvent(document.body,"keydown",p),o.style.top="50%",o.style.left="50%",o.style.display="block",c.isIE_5or6&&(o.style.position="absolute",o.style.top=document.documentElement.scrollTop+200+"px",o.style.left="50%"),document.body.appendChild(o),o.style.marginTop=-(t.getHeight(o)/2)+"px",o.style.marginLeft=-(t.getWidth(o)/2)+"px"};v(),window.setTimeout(function(){m();var e=r.length;if(a.selectionStart!==undefined)a.selectionStart=0,a.selectionEnd=e;else if(a.createTextRange){var t=a.createTextRange();t.collapse(!1),t.moveStart("character",-e),t.moveEnd("character",e),t.select()}a.focus()},0)},extend:function(){function e(t,n){for(var r in n)n.hasOwnProperty(r)&&(typeof t[r]=="object"&&typeof n[r]=="object"?e(t[r],n[r]):t[r]=n[r]);return t}var t={};for(var n=0;n<arguments.length;n++)e(t,arguments[n]);return t}},t={getTop:function(e,t){var n=e.offsetTop;if(!t)while(e=e.offsetParent)n+=e.offsetTop;return n},getHeight:function(e){return e.offsetHeight||e.scrollHeight},getWidth:function(e){return e.offsetWidth||e.scrollWidth},getPageSize:function(){var e,t,n,r;self.innerHeight&&self.scrollMaxY?(e=document.body.scrollWidth,t=self.innerHeight+self.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(e=document.body.scrollWidth,t=document.body.scrollHeight):(e=document.body.offsetWidth,t=document.body.offsetHeight),self.innerHeight?(n=self.innerWidth,r=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(n=document.documentElement.clientWidth,r=document.documentElement.clientHeight):document.body&&(n=document.body.clientWidth,r=document.body.clientHeight);var i=Math.max(e,n),s=Math.max(t,r);return[i,s,n,r]}},n=function(t,n){var i=this,s=t;this.init=function(){if(!e.isVisible(s))return;this.setInputAreaSelectionStartEnd(),this.scrollTop=s.scrollTop;if(!this.text&&s.selectionStart||s.selectionStart===0)this.text=s.value},this.setInputAreaSelection=function(){if(!e.isVisible(s))return;if(s.selectionStart!==undefined&&!c.isOpera)s.focus(),s.selectionStart=i.start,s.selectionEnd=i.end,s.scrollTop=i.scrollTop;else if(document.selection){if(typeof document.activeElement!="unknown"&&document.activeElement&&document.activeElement!==s)return;s.focus();var t=s.createTextRange();t.moveStart("character",-s.value.length),t.moveEnd("character",-s.value.length),t.moveEnd("character",i.end),t.moveStart("character",i.start),t.select()}},this.setInputAreaSelectionStartEnd=function(){if(s.selectionStart||s.selectionStart===0)i.start=s.selectionStart,i.end=s.selectionEnd;else if(document.selection){i.text=e.fixEolChars(s.value);var t;n.ieRetardedClick&&n.ieCachedRange?(t=n.ieCachedRange,n.ieRetardedClick=!1):t=document.selection.createRange();var r=e.fixEolChars(t.text),o="",u=o+r+o;t.text=u;var a=e.fixEolChars(s.value);t.moveStart("character",-u.length),t.text=r,i.start=a.indexOf(o),i.end=a.lastIndexOf(o)-o.length;var f=i.text.length-e.fixEolChars(s.value).length;if(f){t.moveStart("character",-r.length);while(f--)r+="\n",i.end+=1;t.text=r}this.setInputAreaSelection()}},this.restore=function(){i.text!=undefined&&i.text!=s.value&&(s.value=i.text),this.setInputAreaSelection(),s.scrollTop=i.scrollTop},this.getChunks=function(){var t=new r;return t.before=e.fixEolChars(i.text.substring(0,i.start)),t.startTag="",t.selection=e.fixEolChars(i.text.substring(i.start,i.end)),t.endTag="",t.after=e.fixEolChars(i.text.substring(i.end)),t.scrollTop=i.scrollTop,t},this.setChunks=function(e){e.before=e.before+e.startTag,e.after=e.endTag+e.after,c.isOpera&&(e.before=e.before.replace(/\n/g,"\r\n"),e.selection=e.selection.replace(/\n/g,"\r\n"),e.after=e.after.replace(/\n/g,"\r\n")),this.start=e.before.length,this.end=e.before.length+e.selection.length,this.text=e.before+e.selection+e.after,this.scrollTop=e.scrollTop},this.init()},r=function(){};r.prototype.findTags=function(t,n){var r=this,i;t&&(i=e.extendRegExp(t,"","$"),this.before=this.before.replace(i,function(e){return r.startTag=r.startTag+e,""}),i=e.extendRegExp(t,"^",""),this.selection=this.selection.replace(i,function(e){return r.startTag=r.startTag+e,""})),n&&(i=e.extendRegExp(n,"","$"),this.selection=this.selection.replace(i,function(e){return r.endTag=e+r.endTag,""}),i=e.extendRegExp(n,"^",""),this.after=this.after.replace(i,function(e){return r.endTag=e+r.endTag,""}))},r.prototype.trimWhitespace=function(e){this.selection=this.selection.replace(/^(\s*)/,""),e||(this.before+=a.$1),this.selection=this.selection.replace(/(\s*)$/,""),e||(this.after=a.$1+this.after)},r.prototype.addBlankLines=function(e,t,n){e===undefined&&(e=1),t===undefined&&(t=1),e++,t++;var r,i,s=/(^\n*)/.exec(this.selection);this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+(s?s[1]:""),s=/(\n*$)/.exec(this.selection),this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+(s?s[1]:""),s=/(^\n*)/.exec(this.startTag),this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+(s?s[1]:""),s=/(\n*$)/.exec(this.endTag),this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+(s?s[1]:"");if(this.before){r=i="";while(e--)r+="\\n?",i+="\n";n&&(r="\\n*"),this.before=this.before.replace(new a(r+"$",""),i)}if(this.after){r=i="";while(t--)r+="\\n?",i+="\n";n&&(r="\\n*"),this.after=this.after.replace(new a(r,""),i)}};var i=function(t,n,r){var i=this,s=t,o,u,a,f;this.tick=function(){if(!e.isVisible(s))return;if(s.selectionStart||s.selectionStart===0){var t=s.selectionStart,n=s.selectionEnd;if(t!=o||n!=u){o=t,u=n;if(a!=s.value)return a=s.value,!0}}return!1};var l=function(){if(!e.isVisible(s))return;i.tick()&&n()},c=function(){f=window.setInterval(l,r)};this.destroy=function(){window.clearInterval(f)},c()},s=function(n){var r=this,s,o,u,a,f,l,h=3e3,p="delayed",d=function(t,r){e.addEvent(t,"input",r),t.onpaste=r,t.ondrop=r,e.addEvent(t,"keypress",r),e.addEvent(t,"keydown",r),o=new i(n.panels.input,r,n.options.previewPollInterval)},v=function(){var e=0;return window.innerHeight?e=window.pageYOffset:document.documentElement&&document.documentElement.scrollTop?e=document.documentElement.scrollTop:document.body&&(e=document.body.scrollTop),e},m=function(){if(!n.panels.preview&&!n.panels.output)return;var e=n.panels.input.value;if(e&&e==f)return;f=e;var t=(new Date).getTime();!s&&n.showdown&&(s=new n.showdown.converter),s&&(e=s.makeHtml(e));var r=(new Date).getTime();a=r-t,E(e),l=e},g=function(){u&&(window.clearTimeout(u),u=undefined);if(p!=="manual"){var e=0;p==="delayed"&&(e=a),e>h&&(e=h),u=window.setTimeout(m,e)}},y=function(e){return e.scrollHeight<=e.clientHeight?1:e.scrollTop/(e.scrollHeight-e.clientHeight)},b=function(){n.panels.preview&&(n.panels.preview.scrollTop=(n.panels.preview.scrollHeight-n.panels.preview.clientHeight)*y(n.panels.preview)),n.panels.output&&(n.panels.output.scrollTop=(n.panels.output.scrollHeight-n.panels.output.clientHeight)*y(n.panels.output))};this.refresh=function(e){e?(f="",m()):g()},this.processingTime=function(){return a},this.output=function(){return l},this.setUpdateMode=function(e){p=e,r.refresh()};var w=!0,E=function(e){var r=t.getTop(n.panels.input)-v();if(n.panels.output)if(n.panels.output.value!==undefined)n.panels.output.value=e;else{var i=e.replace(/&/g,"&amp;");i=i.replace(/</g,"&lt;"),n.panels.output.innerHTML="<pre><code>"+i+"</code></pre>"}n.panels.preview&&(n.options.tagFilter.enabled&&(e=e.replace(/<[^<>]*>?/gi,function(e){return e.match(n.options.tagFilter.allowedTags)||e.match(n.options.tagFilter.patternLink)||e.match(n.options.tagFilter.patternImage)?e:""})),n.panels.preview.innerHTML=e),b();if(w){w=!1;return}var s=t.getTop(n.panels.input)-v();c.isIE?window.setTimeout(function(){window.scrollBy(0,s-r)},0):window.scrollBy(0,s-r)},S=function(){d(n.panels.input,g),m(),n.panels.preview&&(n.panels.preview.scrollTop=0),n.panels.output&&(n.panels.output.scrollTop=0)};this.destroy=function(){o&&o.destroy()},S()},o=function(t,r,s,o){var u=this,a=[],f=0,l="none",h,p,d,v,m=function(e,t){l!=e&&(l=e,t||y()),!c.isIE||l!="moving"?d=window.setTimeout(g,1):v=null},g=function(){v=new n(r,t),p.tick(),d=undefined};this.setCommandMode=function(){l="command",y(),d=window.setTimeout(g,0)},this.canUndo=function(){return f>1},this.canRedo=function(){return a[f+1]?!0:!1},this.undo=function(){u.canUndo()&&(h?(h.restore(),h=null):(a[f]=new n(r,t),a[--f].restore(),o&&o())),l="none",r.focus(),g()},this.redo=function(){u.canRedo()&&(a[++f].restore(),o&&o()),l="none",r.focus(),g()};var y=function(){var e=v||new n(r,t);if(!e)return!1;if(l=="moving"){h||(h=e);return}h&&(a[f-1].text!=h.text&&(a[f++]=h),h=null),a[f++]=e,a[f+1]=null,o&&o()},b=function(e){var t=!1;if(e.ctrlKey||e.metaKey){var n=e.charCode||e.keyCode,r=String.fromCharCode(n);switch(r){case"y":u.redo(),t=!0;break;case"z":e.shiftKey?u.redo():u.undo(),t=!0}}if(t){e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1);return}},w=function(e){if(!e.ctrlKey&&!e.metaKey){var t=e.keyCode;t>=33&&t<=40||t>=63232&&t<=63235?m("moving"):t==8||t==46||t==127?m("deleting"):t==13?m("newlines"):t==27?m("escape"):(t<16||t>20)&&t!=91&&m("typing")}},E=function(){e.addEvent(r,"keypress",function(e){(e.ctrlKey||e.metaKey)&&(e.keyCode==89||e.keyCode==90)&&e.preventDefault()});var t=function(){(c.isIE||v&&v.text!=r.value)&&d==undefined&&(l="paste",y(),g())};p=new i(r,t,s),e.addEvent(r,"keydown",b),e.addEvent(r,"keydown",w),e.addEvent(r,"mousedown",function(){m("moving")}),r.onpaste=t,r.ondrop=t},S=function(){E(),g(),y()};this.destroy=function(){p&&p.destroy()},S()};WMDEditor.util=e,WMDEditor.position=t,WMDEditor.TextareaState=n,WMDEditor.InputPoller=i,WMDEditor.PreviewManager=s,WMDEditor.UndoManager=o;var u=window.document,a=window.RegExp,f=window.navigator,c=l(),h=function(e,t){e.Command={},e.Global={},e.buttons={},e.showdown=window.Showdown;var r=WMDEditor.util,i=WMDEditor.position,s=e.Command;e.ieCachedRange=null,e.ieRetardedClick=!1,e.editor=function(i){i||(i=function(){});var u=e.panels.input,a=0,l=this,h,p,d,v,m,g=function(t){u.focus();if(t.textOp){m&&m.setCommandMode();var r=new n(e.panels.input,e);if(!r)return;var s=r.getChunks(),o=function(){u.focus(),s&&r.setChunks(s),r.restore(),i()},a=!0,f=t.textOp(s,o,a);f||o()}t.execute&&t.execute(l)},y=function(){m&&(e.buttons["wmd-undo-button"]&&b(e.buttons["wmd-undo-button"],m.canUndo()),e.buttons["wmd-redo-button"]&&b(e.buttons["wmd-redo-button"],m.canRedo()))},b=function(t,n){n?(t.className=t.className.replace(new RegExp("(^|\\s+)disabled(\\s+|$)")," "),c.isIE&&(t.onmousedown=function(){e.ieRetardedClick=!0,e.ieCachedRange=document.selection.createRange()}),t.isHelp||(t.onclick=function(){return this.onmouseout&&this.onmouseout(),g(this),!1})):(t.className+=(t.className?" ":"")+"disabled",t.onmouseover=t.onmouseout=t.onclick=function(){})},w=function(){function l(t,n,r){var i=document.createElement("li");return e.buttons[t]=i,i.className="wmd-button "+t,i.XShift=a+"px",a-=20,n&&(i.title=n),r&&(i.textOp=r),i}function c(e,t,n){var r=l(e,t,n);return b(r,!0),u.appendChild(r),r}function h(){var e=document.createElement("li");return e.className="wmd-spacer",u.appendChild(e),e}var n=typeof t.button_bar=="string"?document.getElementById(t.button_bar||"wmd-button-bar"):t.button_bar,r="0px",i="-20px",o="-40px",u=document.createElement("ul");u.className="wmd-button-row",u=n.appendChild(u);var a=0,p=t.buttons.split(" ");for(var d=0;d<p.length;d++)switch(p[d]){case"bold":c("wmd-bold-button","Strong <strong> Ctrl+B",s.doBold);break;case"italic":c("wmd-italic-button","Emphasis <em> Ctrl+I",s.doItalic);break;case"link":c("wmd-link-button","Hyperlink <a> Ctrl+L",function(e,t,n){return s.doLinkOrImage(e,t,!1)});break;case"blockquote":c("wmd-quote-button","Blockquote <blockquote> Ctrl+Q",s.doBlockquote);break;case"code":c("wmd-code-button","Code Sample <pre><code> Ctrl+K",s.doCode);break;case"image":c("wmd-image-button","Image <img> Ctrl+G",function(e,t,n){return s.doLinkOrImage(e,t,!0)});break;case"ol":c("wmd-olist-button","Numbered List <ol> Ctrl+O",function(e,t,n){s.doList(e,t,!0,n)});break;case"ul":c("wmd-ulist-button","Bulleted List <ul> Ctrl+U",function(e,t,n){s.doList(e,t,!1,n)});break;case"heading":c("wmd-heading-button","Heading <h1>/<h2> Ctrl+H",s.doHeading);break;case"hr":c("wmd-hr-button","Horizontal Rule <hr> Ctrl+R",s.doHorizontalRule);break;case"undo":var v=c("wmd-undo-button","Undo - Ctrl+Z");v.execute=function(e){e.undo()};break;case"redo":var m=c("wmd-redo-button","Redo - Ctrl+Y");/win/.test(f.platform.toLowerCase())?m.title="Redo - Ctrl+Y":m.title="Redo - Ctrl+Shift+Z",m.execute=function(e){e.redo()};break;case"help":var g=l("wmd-help-button");g.isHelp=!0,b(g,!0),u.appendChild(g);var w=document.createElement("a");w.href=t.helpLink,w.target=t.helpTarget,w.title=t.helpHoverTitle,g.appendChild(w);break;case"":h()}y()},E=function(){/\?noundo/.test(document.location.href)&&(e.nativeUndo=!0),e.nativeUndo||(m=new o(e,e.panels.input,e.options.pastePollInterval,function(){i(),y()})),w();var t="keydown";c.isOpera&&(t="keypress"),r.addEvent(u,t,function(t){if(e.options.modifierKeys&&(t.ctrlKey||t.metaKey)){var n=t.charCode||t.keyCode,r=String.fromCharCode(n).toLowerCase();switch(r){case e.options.modifierKeys.bold:if(!e.buttons["wmd-bold-button"])return;g(e.buttons["wmd-bold-button"]);break;case e.options.modifierKeys.italic:if(!e.buttons["wmd-italic-button"])return;g(e.buttons["wmd-italic-button"]);break;case e.options.modifierKeys.link:if(!e.buttons["wmd-link-button"])return;g(e.buttons["wmd-link-button"]);break;case e.options.modifierKeys.quote:if(!e.buttons["wmd-quote-button"])return;g(e.buttons["wmd-quote-button"]);break;case e.options.modifierKeys.code:if(!e.buttons["wmd-code-button"])return;g(e.buttons["wmd-code-button"]);break;case e.options.modifierKeys.image:if(!e.buttons["wmd-image-button"])return;g(e.buttons["wmd-image-button"]);break;case e.options.modifierKeys.orderedList:if(!e.buttons["wmd-olist-button"])return;g(e.buttons["wmd-olist-button"]);break;case e.options.modifierKeys.unorderedList:if(!e.buttons["wmd-ulist-button"])return;g(e.buttons["wmd-ulist-button"]);break;case e.options.modifierKeys.heading:if(!e.buttons["wmd-heading-button"])return;g(e.buttons["wmd-heading-button"]);break;case e.options.modifierKeys.horizontalRule:if(!e.buttons["wmd-hr-button"])return;g(e.buttons["wmd-hr-button"]);break;case e.options.modifierKeys.redo:if(!e.buttons["wmd-redo-button"])return;g(e.buttons["wmd-redo-button"]);break;case e.options.modifierKeys.undo:if(t.shiftKey){if(!e.buttons["wmd-redo-button"])return;g(e.buttons["wmd-redo-button"])}else{if(!e.buttons["wmd-undo-button"])return;g(e.buttons["wmd-undo-button"])}break;default:return}t.preventDefault&&t.preventDefault(),window.event&&(window.event.returnValue=!1)}}),r.addEvent(u,"keyup",function(e){if(!e.shiftKey&&!e.ctrlKey&&!e.metaKey){var t=e.charCode||e.keyCode;t===13&&(fakeButton={},fakeButton.textOp=s.doAutoindent,g(fakeButton))}}),c.isIE&&r.addEvent(u,"keydown",function(e){var t=e.keyCode;if(t===27)return!1})};this.undo=function(){m&&m.undo()},this.redo=function(){m&&m.redo()};var S=function(){E()};this.destroy=function(){m&&m.destroy(),d.parentNode&&d.parentNode.removeChild(d),u&&(u.style.marginTop=""),window.clearInterval(v)},S()},s.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",s.unwrap=function(e){var t=new a("([^\\n])\\n(?!(\\n|"+s.prefixes+"))","g");e.selection=e.selection.replace(t,"$1 $2")},s.wrap=function(e,t){s.unwrap(e);var n=new a("(.{1,"+t+"})( +|$\\n?)","gm");e.selection=e.selection.replace(n,function(e,t){return(new a("^"+s.prefixes,"")).test(e)?e:t+"\n"}),e.selection=e.selection.replace(/\s+$/,"")},s.doBold=function(e,t,n){return s.doBorI(e,2,"strong text")},s.doItalic=function(e,t,n){return s.doBorI(e,1,"emphasized text")},s.doBorI=function(e,t,n){e.trimWhitespace(),e.selection=e.selection.replace(/\n{2,}/g,"\n"),e.before.search(/(\**$)/);var r=a.$1;e.after.search(/(^\**)/);var i=a.$1,s=Math.min(r.length,i.length);if(s>=t&&(s!=2||t!=1))e.before=e.before.replace(a("[*]{"+t+"}$",""),""),e.after=e.after.replace(a("^[*]{"+t+"}",""),"");else if(!e.selection&&i){e.after=e.after.replace(/^([*_]*)/,""),e.before=e.before.replace(/(\s?)$/,"");var o=a.$1;e.before=e.before+i+o}else{!e.selection&&!i&&(e.selection=n);var u=t<=1?"*":"**";e.before=e.before+u,e.after=u+e.after}return},s.stripLinkDefs=function(e,t){return e=e.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(e,n,r,i,s){return t[n]=e.replace(/\s*$/,""),i?(t[n]=e.replace(/["(](.+?)[")]$/,""),i+s):""}),e},s.addLinkDef=function(e,t){var n=0,r={};e.before=s.stripLinkDefs(e.before,r),e.selection=s.stripLinkDefs(e.selection,r),e.after=s.stripLinkDefs(e.after,r);var i="",o=/(\[(?:\[[^\]]*\]|[^\[\]])*\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,u=function(e){n++,e=e.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+n+"]:"),i+="\n"+e},a=function(e,t,i,s){return r[i]?(u(r[i]),t+n+s):e};e.before=e.before.replace(o,a),t?u(t):e.selection=e.selection.replace(o,a);var f=n;return e.after=e.after.replace(o,a),e.after&&(e.after=e.after.replace(/\n*$/,"")),e.after||(e.selection=e.selection.replace(/\n*$/,"")),e.after+="\n\n"+i,f},s.doLinkOrImage=function(e,n,i){e.trimWhitespace(),e.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);if(!(e.endTag.length>1)){if(/\n\n/.test(e.selection)){s.addLinkDef(e,null);return}var o=function(t){console.log(t);if(t!==null){e.startTag=e.endTag="";var r=" [999]: "+t,o=s.addLinkDef(e,r);e.startTag=i?"![":"[",e.endTag="]["+o+"]",e.selection||(i?e.selection="alt text":e.selection="link text")}n()};return i?r.prompt(t.imageDialogText,t.imageDefaultText,o,"Image"):r.prompt(t.linkDialogText,t.linkDefaultText,o,"Link"),!0}e.startTag=e.startTag.replace(/!?\[/,""),e.endTag="",s.addLinkDef(e,null)},s.doAutoindent=function(t,n,r){if(!e.options.autoFormatting)return;e.options.autoFormatting.list&&(t.before=t.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n")),e.options.autoFormatting.quote&&(t.before=t.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n")),e.options.autoFormatting.code&&(t.before=t.before.replace(/(\n|^)[ \t]+\n$/,"\n\n")),r=!1,/(\n|^)[ ]{0,3}([*+-])[ \t]+.*\n$/.test(t.before)&&s.doList&&e.options.autoFormatting.list&&s.doList(t,n,!1,!0),/(\n|^)[ ]{0,3}(\d+[.])[ \t]+.*\n$/.test(t.before)&&s.doList&&e.options.autoFormatting.list&&s.doList(t,n,!0,!0),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(t.before)&&s.doBlockquote&&e.options.autoFormatting.quote&&s.doBlockquote(t,n,r),/(\n|^)(\t|[ ]{4,}).*\n$/.test(t.before)&&s.doCode&&e.options.autoFormatting.code&&s.doCode(t,n,r)},s.doBlockquote=function(e,n,r){e.selection=e.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(t,n,r,i){return e.before+=n,e.after=i+e.after,r}),e.before=e.before.replace(/(>[ \t]*)$/,function(t,n){return e.selection=n+e.selection,""});var i=r?"Blockquote":"";e.selection=e.selection.replace(/^(\s|>)+$/,""),e.selection=e.selection||i,e.before&&(e.before=e.before.replace(/\n?$/,"\n")),e.after&&(e.after=e.after.replace(/^\n?/,"\n")),e.before=e.before.replace(/(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*$)/,function(t){return e.startTag=t,""}),e.after=e.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(t){return e.endTag=t,""});var o=function(t){var n=t?"> ":"";e.startTag&&(e.startTag=e.startTag.replace(/\n((>|\s)*)\n$/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"})),e.endTag&&(e.endTag=e.endTag.replace(/^\n((>|\s)*)\n/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"}))};/^(?![ ]{0,3}>)/m.test(e.selection)?(s.wrap(e,t.lineLength-2),e.selection=e.selection.replace(/^/gm,"> "),o(!0),e.addBlankLines()):(e.selection=e.selection.replace(/^[ ]{0,3}> ?/gm,""),s.unwrap(e),o(!1),!/^(\n|^)[ ]{0,3}>/.test(e.selection)&&e.startTag&&(e.startTag=e.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(e.selection)&&e.endTag&&(e.endTag=e.endTag.replace(/^\n{0,2}/,"\n\n"))),/\n/.test(e.selection)||(e.selection=e.selection.replace(/^(> *)/,function(t,n){return e.startTag+=n,""}))},s.doCode=function(e,t,n){var r=/\S[ ]*$/.test(e.before),i=/^[ ]*\S/.test(e.after);if(!i&&!r||/\n/.test(e.selection)){e.before=e.before.replace(/[ ]{4}$/,function(t){return e.selection=t+e.selection,""});var s=1,o=1;if(/\n(\t|[ ]{4,}).*\n$/.test(e.before)||e.after==="")s=0;/^\n(\t|[ ]{4,})/.test(e.after)&&(o=0),e.addBlankLines(s,o),e.selection?/^[ ]{0,3}\S/m.test(e.selection)?e.selection=e.selection.replace(/^/gm,"    "):e.selection=e.selection.replace(/^[ ]{4}/gm,""):(e.startTag="    ",e.selection=n?"enter code here":"")}else e.trimWhitespace(),e.findTags(/`/,/`/),!e.startTag&&!e.endTag?(e.startTag=e.endTag="`",e.selection||(e.selection=n?"enter code here":"")):e.endTag&&!e.startTag?(e.before+=e.endTag,e.endTag=""):e.startTag=e.endTag=""},s.doList=function(e,n,r,i){var o=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,u=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,f="-",l=1,c=function(){var e;return r?(e=" "+l+". ",l++):e=" "+f+" ",e},h=function(e){return r===undefined&&(r=/^\s*\d/.test(e)),e=e.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(e){return c()}),e};e.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),e.before&&!/\n$/.test(e.before)&&!/^\n/.test(e.startTag)&&(e.before+=e.startTag,e.startTag="");if(e.startTag){var p=/\d+[.]/.test(e.startTag);e.startTag="",e.selection=e.selection.replace(/\n[ ]{4}/g,"\n"),s.unwrap(e),e.addBlankLines(),p&&(e.after=e.after.replace(u,h));if(r==p)return}var d=1;e.before=e.before.replace(o,function(e){return/^\s*([*+-])/.test(e)&&(f=a.$1),d=/[^\n]\n\n[^\n]/.test(e)?1:0,h(e)}),e.selection||(e.selection=i?"List item":" ");var v=c(),m=1;e.after=e.after.replace(u,function(e){return m=/[^\n]\n\n[^\n]/.test(e)?1:0,h(e)}),e.trimWhitespace(!0),e.addBlankLines(d,m,!0),e.startTag=v;var g=v.replace(/./g," ");s.wrap(e,t.lineLength-g.length),e.selection=e.selection.replace(/\n/g,"\n"+g)},s.doHeading=function(e,n,r){e.selection=e.selection.replace(/\s+/g," "),e.selection=e.selection.replace(/(^\s+|\s+$)/g,"");if(!e.selection){e.startTag="## ",e.selection="Heading",e.endTag=" ##";return}var i=0;e.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(e.startTag)&&(i=a.lastMatch.length),e.startTag=e.endTag="",e.findTags(null,/\s?(-+|=+)/),/=+/.test(e.endTag)&&(i=1),/-+/.test(e.endTag)&&(i=2),e.startTag=e.endTag="",e.addBlankLines(1,1);var s=i==0?2:i-1;if(s>0){var o=s>=2?"-":"=",u=e.selection.length;u>t.lineLength&&(u=t.lineLength),e.endTag="\n";while(u--)e.endTag+=o}},s.doHorizontalRule=function(e,t,n){e.startTag="----------\n",e.selection="",e.addBlankLines(2,1,!0)}}})(),Showdown={},Showdown.converter=function(){var e,t,n,r=0;this.makeHtml=function(r){return e=[],t=[],n=[],r=r.replace(/~/g,"~T"),r=r.replace(/\$/g,"~D"),r=r.replace(/\r\n/g,"\n"),r=r.replace(/\r/g,"\n"),r="\n\n"+r+"\n\n",r=M(r),r=r.replace(/^[ \t]+$/mg,""),r=s(r),r=i(r),r=u(r),r=A(r),r=r.replace(/~D/g,"$$"),r=r.replace(/~T/g,"~"),r=r.replace(/https?\:\/\/[^"\s<>]*[^.,;'">\:\s<>\)\]\!]/g,function(e,t){var n=r.slice(Math.max(0,r.lastIndexOf("\n",t)),t),i=r.slice(t);return n.match(/<([a-z]+)\s[^>]+>?$/)&&i.match(/^[^>]*>/)?e:"<a href='"+e+"'>"+e+"</a>"}),r=r.replace(/[a-z0-9_\-+=.]+@[a-z0-9\-]+(\.[a-z0-9\-]+)+/ig,function(e,t,n){var i=r.slice(Math.max(0,r.lastIndexOf("\n",n)),n);return i.match(/<([a-z]+)\s[^>]+>?$/)||i.match(/mailto\:$/)?e:"<a href='mailto:"+e+"'>"+e+"</a>"}),r};var i=function(n){return n=n.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(n,r,i,s,o){return r=r.toLowerCase(),e[r]=T(i),s?s+o:(o&&(t[r]=o.replace(/"/g,"&quot;")),"")}),n},s=function(e){e=e.replace(/\n/g,"\n\n");var t="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del",n="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math";return e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,o),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,o),e=e.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,o),e=e.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,o),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,o),e=e.replace(/\n\n/g,"\n"),e},o=function(e,t){var r=t;return r=r.replace(/\n\n/g,"\n"),r=r.replace(/^\n/,""),r=r.replace(/\n+$/g,""),r="\n\n~K"+(n.push(r)-1)+"K\n\n",r},u=function(e){e=d(e);var t=y("<hr />");return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,t),e=m(e),e=g(e),e=S(e),e=s(e),e=x(e),e},a=function(e){return e=b(e),e=f(e),e=C(e),e=h(e),e=l(e),e=k(e),e=T(e),e=N(e),e=E(e),e=e.replace(/ {2,}\n/g," <br />\n"),e},f=function(e){var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=_(t,"\\`*_"),t}),e},l=function(e){return e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,c),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,c),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,c),e},c=function(n,r,i,s,o,u,a,f){f===undefined&&(f="");var l=r,c=i,h=s.toLowerCase(),p=o,d=f,v=!1;if(p===""){h===""?h=c.toLowerCase().replace(/ ?\n/g," "):h[0]=="!"&&(v=!0,h=h.substr(1)),p="#"+h;if(e[h]!==undefined)p=e[h],t[h]!==undefined&&(d=t[h]),p[0]=="!"&&(v=!0,p=p.substr(1));else{if(!(l.search(/\(\s*\)$/m)>-1))return l;p=""}}else p[0]=="!"&&(v=!0,p=p.substr(1));p=_(p,"*_");var m='<a href="'+p+'"';return d!==""&&(d=d.replace(/"/g,"&quot;"),d=_(d,"*_"),m+=' title="'+d+'"'),v&&(m+=' target="_blank"'),m+=">"+c+"</a>",m},h=function(e){return e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,p),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,p),e},p=function(n,r,i,s,o,u,a,f){var l=r,c=i,h=s.toLowerCase(),p=o,d=f;d||(d="");if(p===""){h===""&&(h=c.toLowerCase().replace(/ ?\n/g," ")),p="#"+h;if(e[h]===undefined)return l;p=e[h],t[h]!==undefined&&(d=t[h])}c=c.replace(/"/g,"&quot;"),p=_(p,"*_");var v='<img src="'+p+'" alt="'+c+'"';return d=d.replace(/"/g,"&quot;"),d=_(d,"*_"),v+=' title="'+d+'"',v+=" />",v},d=function(e){return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return y("<h1>"+a(t)+"</h1>")}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,
t){return y("<h2>"+a(t)+"</h2>")}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,n){var r=t.length;return y("<h"+r+">"+a(n)+"</h"+r+">")}),e},v,m=function(e){e+="~0";var t=/^(([ ]{0,3}([*+\-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+\-]|\d+[.])[ \t]+)))/gm;return r?e=e.replace(t,function(e,t,n){var r=t,i=n.search(/[*+\-]/g)>-1?"ul":"ol";r=r.replace(/\n{2,}/g,"\n\n\n");var s=v(r);return s=s.replace(/\s+$/,""),s="<"+i+">"+s+"</"+i+">\n",s}):(t=/(\n\n|^\n?)(([ ]{0,3}([*+\-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+\-]|\d+[.])[ \t]+)))/g,e=e.replace(t,function(e,t,n,r){var i=t,s=n,o=r.search(/[*+\-]/g)>-1?"ul":"ol";s=s.replace(/\n{2,}/g,"\n\n\n");var u=v(s);return u=i+"<"+o+">\n"+u+"</"+o+">\n",u})),e=e.replace(/~0/,""),e};v=function(e){return r++,e=e.replace(/\n{2,}$/,"\n"),e+="~0",e=e.replace(/(\n)?(^[ \t]*)([*+\-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+\-]|\d+[.])[ \t]+))/gm,function(e,t,n,r,i){var s=i,o=t,f=n;return o||s.search(/\n{2,}/)>-1?s=u(O(s)):(s=m(O(s)),s=s.replace(/\n$/,""),s=a(s)),"<li>"+s+"</li>\n"}),e=e.replace(/~0/g,""),r--,e};var g=function(e){return e+="~0",e=e.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,n){var r=t,i=n;return r=w(O(r)),r=M(r),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,""),r="<pre><code>"+r+"\n</code></pre>",y(r)+i}),e=e.replace(/~0/,""),e},y=function(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(n.push(e)-1)+"K\n\n"},b=function(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,n,r,i){var s=r;return s=s.replace(/^([ \t]*)/g,""),s=s.replace(/[ \t]*$/g,""),s=w(s),t+"<code>"+s+"</code>"}),e=e.replace(/(^|[^\\])(\^{2})([^\r]*?[^\^]{2})\2(?!\^)/gm,function(e,t,n,r,i){var s=r;return s=s.replace(/^([ \t]*)/g,""),s=s.replace(/[ \t]*$/g,""),s=w(s),t+"<sup>"+s+"</sup>"}),e=e.replace(/(^|[^\\])(,{2})([^\r]*?[^,]{2})\2(?!,)/gm,function(e,t,n,r,i){var s=r;return s=s.replace(/^([ \t]*)/g,""),s=s.replace(/[ \t]*$/g,""),s=w(s),t+"<sub>"+s+"</sub>"}),e=e.replace(/(^|[^\\])(~T~T)([^\r]*?[^~]{2})\2(?!~)/gm,function(e,t,n,r,i){var s=r;return s=s.replace(/^([ \t]*)/g,""),s=s.replace(/[ \t]*$/g,""),s=w(s),t+"<strike>"+s+"</strike>"}),e},w=function(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/\u2026/g,"&hellip;").replace(/\u00AB/g,"&laquo;").replace(/\u00BB/g,"&raquo;").replace(/\u201C/g,"&ldquo;").replace(/\u201D/g,"&rdquo;").replace(/\u2018/g,"&lsquo;").replace(/\u2019/g,"&rsquo;").replace(/\u2014/g,"&mdash;").replace(/\u2013/g,"&ndash;").replace(/\u2022/g,"&bull;").replace(/\u2122/g,"&trade;").replace(/\u00A9/g,"&copy;").replace(/\u00AE/g,"&reg;"),e=_(e,"*_{}[]\\",!1),e},E=function(e){return e=e.replace(/(\*\*)(?=\S)([^\r]*?\S[*]*)\1/g,"<strong>$2</strong>"),e=e.replace(/(\w)_(\w)/g,"$1~E95E$2"),e=e.replace(/(\*)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>"),e=e.replace(/(_)(?=\S)([^\r]*?\S)\1/g,"<u>$2</u>"),e},S=function(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var n=t;return n=n.replace(/^[ \t]*>[ \t]?/gm,"~0"),n=n.replace(/~0/g,""),n=n.replace(/^[ \t]+$/gm,""),n=u(n),n=n.replace(/(^|\n)/g,"$1  "),n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var n=t;return n=n.replace(/^ {2}/mg,"~0"),n=n.replace(/~0/g,""),n}),y("<blockquote>\n"+n+"\n</blockquote>")}),e},x=function(e){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");var t,r=e.split(/\n{2,}/g),i=[],s=r.length;for(t=0;t<s;t++){var o=r[t],u="<p>";o.search(/~K(\d+)K/g)>=0?i.push(o):o.search(/\S/)>=0&&(o=a(o),o.substr(0,2)==="->"&&(o.substr(-5)==="&lt;-"?(u='<p align="center">',o=o.slice(2,-5)):(u='<p align="right">',o=o.substring(2))),o=o.replace(/\n/g,"<br />"),o=o.replace(/^([ \t]*)/g,u),o+="</p>",i.push(o))}s=i.length;for(t=0;t<s;t++)while(i[t].search(/~K(\d+)K/)>=0){var f=n[RegExp.$1];f=f.replace(/\$/g,"$$$$"),i[t]=i[t].replace(/~K\d+K/,f)}return i.join("\n\n")},T=function(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?\$!])/gi,"&lt;"),e=e.replace(/\u2026/g,"&hellip;").replace(/\u00AB/g,"&laquo;").replace(/\u00BB/g,"&raquo;").replace(/\u201C/g,"&ldquo;").replace(/\u201D/g,"&rdquo;").replace(/\u2018/g,"&lsquo;").replace(/\u2019/g,"&rsquo;").replace(/\u2014/g,"&mdash;").replace(/\u2013/g,"&ndash;").replace(/\u2022/g,"&bull;").replace(/\u2122/g,"&trade;").replace(/\u00A9/g,"&copy;").replace(/\u00AE/g,"&reg;"),e},N=function(e){return e=e.replace(/\.\.\./g,"&hellip;").replace(/\(c\)/g,"&copy;").replace(/\(r\)/g,"&reg;").replace(/\(tm\)/g,"&trade;").replace(/\-\-/g,"&mdash;"),e},C=function(e){return e=e.replace(/\\(\\)/g,D),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,D),e},k=function(e){return e=e.replace(/(?:")<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),e=e.replace(/<(?:mailto:)?([\-.\w]+\@[\-a-z0-9]+(\.[\-a-z0-9]+)*\.[a-z]+)>/gi,function(e,t){return L(A(t))}),e},L=function(e){function t(e){var t="0123456789ABCDEF",n=e.charCodeAt(0);return t.charAt(n>>4)+t.charAt(n&15)}var n=[function(e){return"&#"+e.charCodeAt(0)+";"},function(e){return"&#x"+t(e)+";"},function(e){return e}];return e="mailto:"+e,e=e.replace(/./g,function(e){if(e=="@")e=n[Math.floor(Math.random()*2)](e);else if(e!=":"){var t=Math.random();e=t>.9?n[2](e):t>.45?n[1](e):n[0](e)}return e}),e='<a href="'+e+'">'+e+"</a>",e=e.replace(/">.+:/g,'">'),e},A=function(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t,10);return String.fromCharCode(n)}),e},O=function(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,""),e},M=function(e){return e=e.replace(/\t(?=\t)/g,"    "),e=e.replace(/\t/g,"~A~B"),e=e.replace(/~B(.+?)~A/g,function(e,t,n){var r=t,i=4-r.length%4;for(var s=0;s<i;s++)r+=" ";return r}),e=e.replace(/~A/g,"    "),e=e.replace(/~B/g,""),e},_=function(e,t,n){var r="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(r="\\\\"+r);var i=new RegExp(r,"g");return e=e.replace(i,D),e},D=function(e,t){var n=t.charCodeAt(0);return"~E"+n+"E"}},$(function(){new WMDEditor({input:"wmd-input",button_bar:"wmd-button-bar",preview:"wmd-preview",helpLink:"http://daringfireball.net/projects/markdown/syntax"})});